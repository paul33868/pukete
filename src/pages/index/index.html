<ion-header>
  <ion-navbar>
    <button ion-button
            menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-input type="text"
               placeholder="{{dictionary?.index?.inputs?.event}}"
               *ngIf="event?.name"
               [(ngModel)]="event.name"
               (blur)="finishEditingName()"></ion-input>
    <ion-buttons right>
      <button ion-button
              icon-only
              (click)="addEvent()"
              [disabled]="event?.persons?.length < 1">
        <ion-icon name="add-circle"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content padding>
  <ion-card *ngFor="let person of event?.persons">
    <ion-item *ngIf="person?.name">
      <strong>{{person?.name}}</strong> {{dictionary?.index?.alreadyPaid}}: <strong>${{(person.expense1Amount - -person.expense2Amount - -person.expense3Amount) |
      number:'1.2-2'}}</strong>
      <button ion-button
              icon-only
              item-end
              clear
              color="danger"
              (click)="removePerson(person)">
        <ion-icon name="trash"></ion-icon>
        </button>
    </ion-item>
    <ion-card-content>
      <ion-item>
        <ion-input type="text"
                   placeholder="{{dictionary?.index?.inputs?.person}}"
                   [(ngModel)]="person.name"
                   (blur)="checkPersonsName(person)"
                   (keyup)="checkPersonsName(person)"
                   required>
        </ion-input>
      </ion-item>
      <span class="error-message">{{person.error}}</span>

      <div class="checkbox-container">
        <p>{{dictionary?.index?.inputs?.alreadyPaid}}</p>
        <div>
          <ion-input type="text"
                     [(ngModel)]="event.expense1Label"
                     required
                     (keyup)="checkEventName()">
          </ion-input>
          <ion-input type="number"
                     [(ngModel)]="person.expense1Amount"
                     min="0">
          </ion-input>
        </div>
        <div>
          <ion-input type="text"
                     [(ngModel)]="event.expense2Label"
                     required
                     (keyup)="checkEventName()">
          </ion-input>
          <ion-input type="number"
                     [(ngModel)]="person.expense2Amount"
                     min="0">
          </ion-input>
        </div>
        <div>
          <ion-input type="text"
                     [(ngModel)]="event.expense3Label"
                     required
                     (keyup)="checkEventName()">
          </ion-input>
          <ion-input type="number"
                     [(ngModel)]="person.expense3Amount"
                     min="0">
          </ion-input>
        </div>
      </div>

      <div class="checkbox-container">
        <p>{{dictionary?.index?.inputs?.isCounted}}</p>
        <div>
          <ion-item>
            <ion-label>{{event?.expense1Label}}</ion-label>
            <ion-checkbox [(ngModel)]="person.inExpense1"></ion-checkbox>
          </ion-item>
        </div>
        <div>
          <ion-item>
            <ion-label>{{event?.expense2Label}}</ion-label>
            <ion-checkbox [(ngModel)]="person.inExpense2"></ion-checkbox>
          </ion-item>
        </div>
        <div>
          <ion-item>
            <ion-label>{{event?.expense3Label}}</ion-label>
            <ion-checkbox [(ngModel)]="person.inExpense3"></ion-checkbox>
          </ion-item>
        </div>
      </div>
      <span class="error-message"
            *ngIf="event.expense1Label === '' || event.expense2Label === '' || event.expense3Label === ''">Please provide a name for all the expenses</span>
    </ion-card-content>
  </ion-card>

</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-buttons left>
      <button ion-button
              icon-only
              (click)="addPerson()">
        <ion-icon name="person-add"></ion-icon>
      </button>
    </ion-buttons>
    <ion-buttons right>
      <button ion-button
              icon-only
              (click)="calculate()"
              [disabled]="errorsOnTheEvent || errorsOnTheEventsName">
        <ion-icon name="calculator"></ion-icon>
      </button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>